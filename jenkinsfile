pipeline {
    agent any   // åœ¨ä»»æ„å¯ç”¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼ˆæ„å»ºæœºï¼‰

    environment {
        PROJECT = "demo-app"
    }

    stages {

        stage('Checkout') {
            steps {
                echo "=== æ‹‰å–ä»£ç ä¸­ ==="
                // é€šå¸¸è¿™é‡Œ Jenkins ä¼šè‡ªåŠ¨ä» Git æ‹‰ä»£ç 
                sh 'pwd && ls -la'
            }
        }

        stage('Build') {
            steps {
                echo "=== ç¼–è¯‘é˜¶æ®µ ==="
                sh 'echo "æ¨¡æ‹Ÿç¼–è¯‘ ${PROJECT}"'
            }
        }

        stage('Test') {
            steps {
                echo "=== æµ‹è¯•é˜¶æ®µ ==="
                sh '''
                    echo "è¿è¡Œå•å…ƒæµ‹è¯•..."
                    sleep 2
                    echo "æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…"
                '''
            }
        }

        stage('Deploy') {
            when {
                branch 'main' // åªåœ¨ main åˆ†æ”¯ä¸Šéƒ¨ç½²
            }
            steps {
                echo "=== éƒ¨ç½²é˜¶æ®µ ==="
                sh '''
                    echo "éƒ¨ç½²åº”ç”¨åˆ°æµ‹è¯•ç¯å¢ƒ..."
                    sleep 2
                    echo "éƒ¨ç½²æˆåŠŸ ğŸš€"
                '''
            }
        }
    }

    post {
        always {
            echo "=== æ¸…ç†å·¥ä½œåŒº ==="
            cleanWs()
        }
        success {
            echo "âœ… Pipeline æ‰§è¡ŒæˆåŠŸ"
        }
        failure {
            echo "âŒ Pipeline æ‰§è¡Œå¤±è´¥"
        }
    }
}
